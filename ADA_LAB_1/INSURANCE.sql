CREATE DATABASE Insurance;
USE Insurance;
CREATE TABLE PERSON (
	DRIVER_ID VARCHAR(10),
    NAME VARCHAR(30),
    ADDRESS VARCHAR(50),
    PRIMARY KEY(DRIVER_ID)
    );
    
CREATE TABLE CAR (
	REG_NO VARCHAR(20),
    MODEL VARCHAR(200),
    YEAR INT,
    PRIMARY KEY(REG_NO)
    );
    
CREATE TABLE ACCIDENT(
	REPORT_NUMBER INT,
    ADATE DATE,
    LOCATION VARCHAR(30),
    PRIMARY KEY(REPORT_NUMBER)
    );
    
DROP TABLE CAR;

CREATE TABLE CAR (
	REG_NO VARCHAR(20),
    MODEL VARCHAR(200),
    CYEAR INT,
    PRIMARY KEY(REG_NO)
    );
    
DROP TABLE PERSON;

CREATE TABLE PERSON (
	DRIVER_ID VARCHAR(10),
    PNAME VARCHAR(30),
    ADDRESS VARCHAR(50),
    PRIMARY KEY(DRIVER_ID)
    );
    
CREATE TABLE OWNS (
	DRIVER_ID VARCHAR(20),
    REG_NO VARCHAR(20),
    PRIMARY KEY(DRIVER_ID, REG_NO),
    
    FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID),
    FOREIGN KEY(REG_NO) REFERENCES CAR(REG_NO)
    );

CREATE TABLE PARTICIPATED (
	DRIVER_ID VARCHAR(20),
    REG_NO VARCHAR(20),
    REPORT_NO INT,
    DAMAGE_AMT INT,
    FOREIGN KEY(DRIVER_ID) REFERENCES OWNS(DRIVER_ID),
    FOREIGN KEY(REG_NO) REFERENCES OWNS(REG_NO),
    FOREIGN KEY(REPORT_NO) REFERENCES ACCIDENT(REPORT_NUMBER)
    );
    
DROP TABLE OWNS, PARTICIPATED;

CREATE TABLE OWNS (
	DRIVER_ID VARCHAR(20),
    REG_NO VARCHAR(20),
    PRIMARY KEY(DRIVER_ID, REG_NO),
    
    FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID) ON DELETE CASCADE,
    FOREIGN KEY(REG_NO) REFERENCES CAR(REG_NO) ON DELETE CASCADE
    );

CREATE TABLE PARTICIPATED (
	DRIVER_ID VARCHAR(20),
    REG_NO VARCHAR(20),
    REPORT_NO INT,
    DAMAGE_AMT INT,
    FOREIGN KEY(DRIVER_ID) REFERENCES OWNS(DRIVER_ID) ON DELETE CASCADE,
    FOREIGN KEY(REG_NO) REFERENCES OWNS(REG_NO) ON DELETE CASCADE,
    FOREIGN KEY(REPORT_NO) REFERENCES ACCIDENT(REPORT_NUMBER) ON DELETE CASCADE
    );

INSERT INTO PERSON(DRIVER_ID, PNAME, ADDRESS) VALUES (1111, 'RAMU', 'K.S.LAYOUT'), (2222, 'JOHN', 'INDIRANAGAR'), (3333, 'PRIYA', 'JAYANAGAR'), (4444, 'GOPAL', 'WHITEFIELD'), (5555, 'LATHA', 'VIJAYANAGAR');

INSERT INTO CAR(REG_NO, MODEL, CYEAR) VALUES ('KA04Q2301', 'MARUTHI-DX', 2000), ('KA05P1000', 'FORDICON', 2000), ('KA03L1234', 'ZEN-VXI', 1999), ('KA03L9999', 'MARUTH-DX', 2002), ('KA01P4020', 'INDICA-VX', 2002);

INSERT INTO ACCIDENT(REPORT_NUMBER, ADATE, LOCATION) VALUES (12, '2002-06-01', 'M G ROAD'), (200, '2002-12-10', 'DOUBLEROAD'), (300, '1999-07-23', 'M G ROAD'), (25000, '2000-06-11', 'RESIDENCY ROAD'), (26500, '2001-10-16', 'RICHMOND ROAD');

INSERT INTO OWNS(DRIVER_ID, REG_NO) VALUES ('1111', 'KA04Q2301'), ('1111', 'KA05P1000'), ('2222', 'KA03L1234'), ('3333', 'KA03L9999'), ('4444', 'KA01P4020');

INSERT INTO PARTICIPATED(DRIVER_ID, REG_NO, REPORT_NO, DAMAGE_AMT) VALUE ('1111', 'KA04Q2301', 12, 20000), ('2222', 'KA03L1234', 200, 500), ('3333', 'KA03L9999', 300, 10000), ('4444', 'KA01P4020', 25000, 2375), ('1111', 'KA05P1000', 26500, 70000), ('2222', 'KA03L9999', 12, 10000);

DESC PERSON;

SELECT * FROM PERSON;
SELECT * FROM CAR;
SELECT * FROM ACCIDENT;
SELECT * FROM OWNS;
SELECT * FROM PARTICIPATED;

-- DEMONSTRATE HOW YOU UPDATE DAMAGE AMOUNT FOR THECAR WITH A SPECIFIC REGNO IN ACCIDENT WITH REPORTNO 12 TO 25000

UPDATE PARTICIPATED SET DAMAGE_AMT=25000 WHERE REPORT_NO =12 AND REG_NO='KA04Q2301';

SELECT * FROM PARTICIPATED;

-- ADD NEW ACCIDENT TO DATABASE
INSERT INTO ACCIDENT(REPORT_NUMBER, ADATE, LOCATION) VALUE(13, '2007-05-11', 'BASAVANAGUDI');

-- FIND THE TOTAL NO OF PEOPLE WHO OWNED CARS THAT WERE INVOLVED IN ACCIDENTS 2002.

SELECT COUNT(*) FROM ACCIDENT WHERE YEAR(ADATE) = 2002;

-- FIND THE NO OF ACCIDENTS IN WHICH CARS BELONGING TO A SPECIFIC MODEL WERE INVOLVED.

SELECT COUNT(ACCIDENT.REPORT_NUMBER)
FROM ACCIDENT , PARTICIPATED , CAR 
WHERE ACCIDENT.REPORT_NUMBER=PARTICIPATED.REPORT_NO
AND
PARTICIPATED.REG_NO=CAR.REG_NO
AND
CAR.MODEL='MARUTHI-DX';

